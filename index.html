# <!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI é æ¸¬æœªä¾†å¥³å‹é•·ç›¸</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        h2 { color: #333; }
        .btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-secondary { background-color: #6c757d; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn:hover { opacity: 0.9; }
        
        input {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        
        /* éš±è—å€å¡Š */
        .hidden { display: none; }
        
        /* åœ–ç‰‡æ¨£å¼ */
        .result-img {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 3px solid #007bff;
        }

        .loading-text {
            font-size: 18px;
            color: #007bff;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="step1">
        <h2>Q1: ä½ ç¾åœ¨å–®èº«å—ï¼Ÿ</h2>
        <button class="btn btn-primary" onclick="nextStep(1, true)">æ˜¯ï¼Œæˆ‘å–®èº«</button>
        <button class="btn btn-secondary" onclick="rejectUser()">å¦ï¼Œæˆ‘æœ‰å°è±¡</button>
    </div>

    <div id="step2" class="hidden">
        <h2>Q2: ç¢ºå®šå–®èº«ï¼Ÿ</h2>
        <p>æœ‰å°è±¡é‚„ç©æœƒè¢«è©›å’’å–”~ ğŸ‘»</p>
        <button class="btn btn-primary" onclick="nextStep(2, true)">ç¢ºå®šå–®èº«ï¼</button>
        <button class="btn btn-secondary" onclick="rejectUser()">é‚„æ˜¯ç®—äº†...</button>
    </div>

    <div id="step3" class="hidden">
        <h2>è¼¸å…¥è³‡æ–™å•Ÿå‹• AI</h2>
        <input type="text" id="userName" placeholder="è«‹è¼¸å…¥å§“å">
        <input type="tel" id="userPhone" placeholder="è«‹è¼¸å…¥é›»è©± (é‹ç®—é—œéµ)">
        <p style="font-size:12px; color:gray;">ä¸Šå‚³ç…§ç‰‡ä»¥å¢åŠ æº–ç¢ºåº¦(é¸å¡«)</p>
        <input type="file" id="userPhoto">
        <button class="btn btn-danger" onclick="startPrediction()">é–‹å§‹é æ¸¬</button>
    </div>

    <div id="loading" class="hidden">
        <h2>AI æ­£åœ¨é‹ç®—ä¸­...</h2>
        <p class="loading-text" id="loadingMsg">åˆ†æé¢ç›¸ç‰¹å¾µ...</p>
        <img src="https://i.gifer.com/ZZ5H.gif" alt="loading" width="50">
    </div>

    <div id="result" class="hidden">
        <h2>ä½ çš„æœªä¾†å¥³å‹æ˜¯...</h2>
        <img id="futureWifeImg" src="" class="result-img">
        <p id="resultName"></p>
        
        <button class="btn btn-primary" onclick="shareResult()">åˆ†äº«çµ¦æœ‹å‹</button>
        <button class="btn btn-danger" onclick="wantToDate()">çœŸçš„å¥½æƒ³è„«å–®</button>
    </div>
</div>

<script>
    // âš ï¸ã€è«‹å°‡é€™è£¡æ›æˆä½ å‰›å‰›è¤‡è£½çš„ Google Apps Script ç¶²å€ã€‘âš ï¸
    const scriptURL = "https://script.google.com/macros/s/AKfycby7A67cffg8adasBWZo0eeO61DHmF3CHHchedP6mPIf4vFXU-ryQDq-_tAyEM6ZdMiYhw/exec";

    // æœªä¾†å¥³å‹åœ–ç‰‡åº« (è«‹æ›æˆä½ çš„é›²ç«¯åœ–ç‰‡é€£çµ)
    const wifeImages = [
        "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=400", 
        "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400", 
        "https://images.unsplash.com/photo-1517841905240-472988babdf9?w=400", 
        "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400", 
        "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=400"  
    ];

    // å…¨åŸŸè®Šæ•¸ï¼Œæš«å­˜ä½¿ç”¨è€…è³‡æ–™
    let currentUser = { name: "", phone: "" };

    // é é¢åˆ‡æ›
    function nextStep(currentStep, isYes) {
        if (isYes) {
            document.getElementById(`step${currentStep}`).classList.add('hidden');
            document.getElementById(`step${currentStep + 1}`).classList.remove('hidden');
        }
    }

    // æ‹’çµ•éå–®èº«
    function rejectUser() {
        alert("æ­å–œç¥ä½ é•·é•·ä¹…ä¹…ï¼(éå–®èº«è«‹å‹¿éŠç© XD)");
        location.reload();
    }

    // å‚³é€è³‡æ–™åˆ° Google Sheet çš„é€šç”¨å‡½å¼
    function sendDataToSheet(actionMsg) {
        // æº–å‚™è¦å‚³çš„è³‡æ–™
        const data = {
            name: currentUser.name,
            phone: currentUser.phone,
            action: actionMsg // ä¾‹å¦‚ï¼š"é–‹å§‹é æ¸¬" æˆ– "æƒ³è„«å–®-è«‹è¯çµ¡"
        };

        // ä½¿ç”¨ fetch ç™¼é€ (è¨­å®š mode: 'no-cors' æ˜¯ç‚ºäº†é¿å…è·¨åŸŸéŒ¯èª¤ï¼Œé€™æ˜¯æœ€ç°¡å–®çš„æ–¹æ³•)
        fetch(scriptURL, {
            method: 'POST',
            body: JSON.stringify(data),
            mode: 'no-cors', 
            headers: {
                'Content-Type': 'text/plain'
            }
        }).then(() => {
            console.log("è³‡æ–™å·²å‚³é€: " + actionMsg);
        }).catch(error => {
            console.error('Error!', error.message);
        });
    }

    // æŒ‰ä¸‹é–‹å§‹é æ¸¬
    function startPrediction() {
        const nameInput = document.getElementById('userName').value;
        const phoneInput = document.getElementById('userPhone').value;

        if (!nameInput || !phoneInput) {
            alert("è«‹è¼¸å…¥å§“åå’Œé›»è©±æ‰èƒ½é‹ç®—å–”ï¼");
            return;
        }

        // å„²å­˜åˆ°è®Šæ•¸
        currentUser.name = nameInput;
        currentUser.phone = phoneInput;

        // ã€å‹•ä½œ 1ã€‘åœ¨é€™è£¡å‚³é€ç¬¬ä¸€ç­†è³‡æ–™ï¼šç´€éŒ„èª°ä¾†ç©äº†
        sendDataToSheet("ä½¿ç”¨è€…é€²è¡Œäº†é æ¸¬");

        // ä»‹é¢æµç¨‹
        document.getElementById('step3').classList.add('hidden');
        document.getElementById('loading').classList.remove('hidden');

        const msg = document.getElementById('loadingMsg');
        setTimeout(() => { msg.innerText = "æ­£åœ¨æ¯”å°é›²ç«¯è³‡æ–™åº«..."; }, 1000);
        setTimeout(() => { msg.innerText = "é…å°æˆåŠŸï¼ç”¢ç”Ÿå½±åƒä¸­..."; }, 2500);

        setTimeout(() => {
            showResult(nameInput, phoneInput);
        }, 3500);
    }

    // é¡¯ç¤ºçµæœ
    function showResult(name, phone) {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('result').classList.remove('hidden');

        let sum = 0;
        for (let i = 0; i < phone.length; i++) {
            if (!isNaN(parseInt(phone[i]))) sum += parseInt(phone[i]);
        }
        
        const index = sum % wifeImages.length; 
        document.getElementById('futureWifeImg').src = wifeImages[index];
        document.getElementById('resultName').innerText = `æ­å–œ ${name}ï¼é€™æ˜¯ AI ç‚ºä½ è¨ˆç®—å‡ºçš„æœªä¾†å°è±¡`;
    }

    // åˆ†äº«
    function shareResult() {
        alert("é€£çµå·²è¤‡è£½ï¼å¿«å»å‚³çµ¦æœ‹å‹çœ‹ï¼");
    }

    // æƒ³è„«å–®
    function wantToDate() {
        // ã€å‹•ä½œ 2ã€‘åœ¨é€™è£¡å‚³é€ç¬¬äºŒç­†è³‡æ–™ï¼šç´€éŒ„ä»–æƒ³è„«å–®
        sendDataToSheet("â˜…è¶…ç´šæƒ³è„«å–®-è«‹è–èª•ç§˜æ›¸è¯çµ¡â˜…");

        alert("æ”¶åˆ°ï¼å·²å°‡ä½ çš„æ„é¡˜å‚³é€çµ¦è–èª•ç§˜æ›¸ï¼Œè«‹éœå€™ä½³éŸ³ ğŸ…");
        
        const btn = event.target;
        btn.innerText = "å·²é ç´„è–èª•ç§˜æ›¸";
        btn.disabled = true;
        btn.style.backgroundColor = "#ccc";
    }
</script>

</body>
</html>
